name: Build and Deploy to Azure

on: push

jobs:
  build:
   runs-on: ubuntu-latest
   steps:
    - name: check-into-repo
      uses: actions/checkout@v2
    - name: publish app
      run: dotnet publish -c Release -o app
    - name: upload artifact
      uses: actions/upload-artifact@v2
      with: 
       name: .net-app
       path: app
  deploy:
   needs: build
   runs-on: ubuntu-latest
   environment:
    name: Production
    url: ${{steps.deploy.outputs.webapp-url}}
   permissions:
    id-token: write
   steps:
    - name: login to Azure
      uses: azure/login@v1
      with:
       client-id: ${{secrets.clientId}}
       subscription-id: ${{secrets.subscriptionId}}
       tenant-id: ${{secrets.tenantId}}
    - name: download zip
      uses: actions/download-artifact@v2
      with:
       name: .net-app
    - name: deploy to azure 
      id: deploy
      uses: azure/webapps-deploy@v2
      with:
       app-name: swacky
       package: .
    - name: logout from azure
      run: az logout

